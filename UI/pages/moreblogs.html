<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LogIn</title>
    <link rel="stylesheet" href="../css/moreblogs.css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="shortcut icon" type="image/png" href="../images/mylog.png">
    <style>
      .left-section{
          /* width: 100%; */
          padding-right: 2rem;
          background-color: #03010E;
      }
      .right-section{
        padding-top: 1rem;
        background-color: #03010E;
        color: white;
      }
      .left-section a p{
        color: white;
      }
     .right-section section{
      padding: 0 .5rem;
     }
     .left-section > div {
          margin-top: 1rem;
          flex-basis: 10%;
          margin-left: 6%;
          padding-right: 0rem;
          align-self: auto;
          height: fit-content;
          box-shadow: 0px 0px 40px black;
      }
     .left-section > div:hover {
          box-shadow: 0px 0px 10px rgb(209, 206, 206);
          transition: 1s;
}
.sdisc {
  margin-top: 1rem;
   background-color: #03010E;
}
.sdisc h3{
  padding-bottom: 0.5rem;
  color: #ff6300;
}
.more-sdisc h3{
  padding: 1rem 0 1rem 0;
  color: #ff6300;
}
.blog-imgs{
  width: 100%;
  height: 12rem;
}
.right-imgs{
  width: 100%;
  height: 30rem;
   background-color: #03010E;
}
section{
  margin-bottom: 5rem;
}
.likes{
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 2rem;
}
.likes i{
  font-size: 28px;
  border-radius: 50%;
  border: 1px #ff6300 solid;
  padding: .5rem;
  /* background-color: white; */
}
.likes .like:hover{
  border: 1px white solid;
  background-color: #ff6300;
  transition: 1s;
}
.likes .dislike:hover{
    border: 1px white solid;
  background-color: red;
  /* transition: 1s; */
}
.likes p{
  font-size: 48px;
  color: #ff6300;
}
textarea{
  border: 0;
  background-color: #03010e;
  border: 1px solid #ff6300;
  outline: 0;
  width: 100%;
  height: 5rem;
  padding-top: 1rem;
  color: white;
  font-size: 12px;
}
.bottomcomment{
  width: 15rem;
  /* border: 2px red solid; */
  /* position: absolute; */
}
.comment-button{
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 60%;
}
#addCom{
  border: 0;
  outline: 0;
  border-radius: 5px 5px 0 0;
  border: 1px solid #ff6300;
  background-color: #03010E;
  color: white;
  padding: .3rem;
  margin: .5rem;
}
.comdiv{
  width: 12rem;
  height: fit-content;
  background-color: #03010E;
  box-shadow: 0px 0px 5px white;
  margin: 1rem;
  padding: .3rem;
}
.user{
  margin-right: 10px;
}
    </style>
<body>
      <div class="nav">
        <div class="leftnav"> 
         <label for="" class="logo">BS</label>
        </div>
        <div class="rightnav">
          <ul>
            <li><a class="home" href="./../index.html"></i>Home</a></li>
          </ul>
        </div>
      </div>
    <div class="container">
        <div id="leftBlogs" class="left-section">
          <!-- left side -->
        </div>

        <div id="rightBlogs" class="right-section">
         
        </div>
        <div class="bottomcomment">
           <textarea  id="wComment" cols="10" rows="10" placeholder="Write comment" required></textarea>
           <div class="comment-button">
             <!-- <p>comment(s)</p> -->
             <button onclick="handleAddComment()" id="addCom">Add comment</button>
           </div>
            <div id="comList" style="color: aliceblue;">
             <h1 style="color: #ff6300; font-size: 15px; padding-bottom: 1rem;">Comments</h1>
             </div>
           </div>

<script>
    function generateUniqueId() {
        const timestamp = new Date().getTime();
        const random = Math.floor(Math.random() * 10000); // Adjust the range as needed
        return `${timestamp}${random}`;
      }


      let id =  generateUniqueId();

         // get params
      const param = new URLSearchParams(window.location.search);
      const blogId = param.get("blogId");


       const  comment  = document.getElementById("wComment");


       const getComments = ()=> {
         const comments =  JSON.parse(localStorage.getItem("comments"))  || [];
         let commentOnBlog  =  comments.filter( comment => comment.blogId == blogId);
         return commentOnBlog; 
       }
         
       let commentsOnBlog  = getComments();

       commentsOnBlog.map(comment => {
        document.getElementById("comList").innerHTML +=`
        <div class="comdiv">    
        <h1 style="font-size:20px;"><i class="user fa-solid fa-user"></i>${comment.name}</h1>
        <h4 style="font-size:12px; margin-left: 30px;">${comment.comment}</h4>
        </div>
        `
       })



       const addComment  =  (data) =>{
        const comments  = getComments();
         comments.push({
          id:data.id,
          blogId:data.blogId,
          comment: data.comment,
          name:data.name
         })
         localStorage.setItem("comments" , JSON.stringify( comments));
        console.log(comments);
       }

       const handleAddComment = ()=> {
        console.log(comment.value);
       if (!comment.value) {
        alert("Null comment not allowed")
        return;
       }

       if(!localStorage.getItem("loggedUser")){
        alert("Login first to comment");
        window.location.href = `login.html`

        return;
       }
       const user =  JSON.parse(localStorage.getItem("loggedUser"));
        addComment({
          id,
          blogId,
          comment:comment.value,
          name: user.name,
        })
        window.location.reload()
       }
        function getById(id) {
        const blogs = getBlogs();
        return blogs.find((blog) => blog.id == id);
      }

      let singlePost  =  getById(blogId);


  function getBlogs() {
    const blogsString = localStorage.getItem("blogs");
    return blogsString ? JSON.parse(blogsString) : [];
  }



   let likeCounter = 0;

    function updateCounter() {
      document.getElementById('counter').innerText =  likeCounter + ' Like(s)' ;
    }

    function increaseLikes() {
      likeCounter++;
      updateCounter();
    }

    function decreaseLikes() {
      if (likeCounter > 0) {
        likeCounter--;
        updateCounter();
      }
    }

  document.addEventListener("DOMContentLoaded", function () {
    var moreBlogs = getBlogs();
    const rightBlogs = document.getElementById("rightBlogs");

        rightBlogs.innerHTML = `
        <section>
          <div >
            <div class="more-photo1"><img class="right-imgs" src="${singlePost.blogImg}" alt=""></div>
            <div class="more-sdisc">
              <h3>${singlePost.title}</h3>
              <p>${singlePost.blogDisc}</p>
              <div class="comment-div">
                <div class="likes">
                  <i class="like fa-regular fa-thumbs-up" onclick="increaseLikes()"></i>
                  <div id="counter"> 0 Like(s)</div>
                    
                  <i class="dislike fa-regular fa-thumbs-down" onclick="decreaseLikes()"></i>
                </div>
        
              </div>
                
                </div>
            </div>
          </div>
         
        </section>`;

    moreBlogs.map((blog, index) => {
      const leftBlogs = document.getElementById("leftBlogs");
      leftBlogs.innerHTML += `
                <div class="blog1">
                  <a href="?blogId=${blog.id}">
                    <div class="photo1"><img class="blog-imgs" src="${blog.blogImg}" alt=""></div>
                    <div class="sdisc">
                      <h3 class="h3">${blog.title}</h3>
                      <p>${blog.blogDisc.slice(0, 150)}.....</p>
                    </div>
                  </a>
                </div>`;
    });
  });
</script>
    <script src="../scripts/moreblogs.js"></script>
</body>
</html>


